<!DOCTYPE html>
<html lang="vi">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>MTT | SI√äU M·∫†NG X√É H·ªòI T·∫æT 2026</title>
   
   <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&family=Pattaya&display=swap" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
   <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
 
   <style>
       :root {
           --tet-do: #d63031;
           --tet-vang: #ffa502;
           --mtt-gradient: linear-gradient(135deg, #d63031 0%, #740001 100%);
       }
 
       * { margin: 0; padding: 0; box-sizing: border-box; cursor: url('https://cur.cursors-4u.net/symbols/sym-1/sym46.cur'), auto; }
       
       body { 
           font-family: 'Lexend', sans-serif; 
           background: #4b0101;
           background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png'), radial-gradient(circle, #740001 0%, #2b0000 100%);
           color: #fff;
           overflow-x: hidden;
           min-height: 100vh;
       }
 
       /* --- HI·ªÜU ·ª®NG ƒê√àN L·ªíNG --- */
       .lantern {
           position: fixed; top: -50px; font-size: 30px; z-index: 0; opacity: 0.6;
           animation: swing 3s ease-in-out infinite alternate;
       }
       @keyframes swing { from { transform: rotate(-10deg); } to { transform: rotate(10deg); } }
 
       /* --- HEADER SI√äU C·∫§P --- */
       nav {
           position: fixed; top: 0; width: 100%; height: 75px;
           background: rgba(116, 0, 1, 0.9); backdrop-filter: blur(20px);
           display: flex; justify-content: space-between; align-items: center;
           padding: 0 5%; z-index: 1001; border-bottom: 2pxsolid var(--tet-vang);
           box-shadow: 0 5px 20px rgba(0,0,0,0.5);
       }
       
       .mtt-logo {
           font-family: 'Pattaya'; font-size: 2rem; color: var(--tet-vang);
           text-shadow: 0 0 10px var(--tet-vang);
           animation: pulse 2s infinite;
       }
 
       /* --- GRID CH√çNH --- */
       .main-grid { max-width: 1300px; margin: 100px auto 0; display: grid; grid-template-columns: 300px 1fr 300px; gap: 25px; padding: 20px; }
 
       .khung-glass {
           background: rgba(255, 255, 255, 0.07); border-radius: 25px;
           border: 1px solid rgba(255,215,0,0.2); padding: 25px;
           backdrop-filter: blur(15px); box-shadow: 0 15px 35pxrgba(0,0,0,0.4);
       }
 
       /* --- B√ÄI VI·∫æT NEUMORPHISM --- */
       .the-bai-viet {
           background: #fff; color: #333; border-radius: 20px;
           margin-bottom: 25px; position: relative;
           transition: transform 0.3s; border-left: 8px solid var(--tet-do);
       }
       .the-bai-viet:hover { transform: translateY(-5px); }
 
       .badge {
           background: var(--tet-do); color: white; padding: 2px10px;
           border-radius: 10px; font-size: 0.7rem; font-weight: 800;
       }
 
       .nut-bam {
           background: var(--mtt-gradient); border: none; color: white; 
           padding: 12px 25px; border-radius: 50px; font-weight: 800; 
           cursor: pointer; box-shadow: 0 5px 15px rgba(214, 48, 49, 0.4);
           transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
       }
       .nut-bam:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(214, 48, 49, 0.6); }
 
       /* --- L√å X√å MAY M·∫ÆN --- */
       #lucky-box {
           position: fixed; bottom: 100px; left: 30px; width: 70px; cursor: pointer;
           animation: bounce 2s infinite; z-index: 1000;
       }
       @keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-20px);} }
 
       @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } .side { display: none; } }
   </style>
</head>
<body onclick="createFirework(event)">
 
   <nav>
       <div class="mtt-logo">MAI THANH TH·∫æ 2026</div>
       <div id="user-info" style="font-weight:bold; color:var(--tet-vang); background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 30px;"></div>
   </nav>
 
   <div id="lucky-box" onclick="getLucky(event)">
       <img src="https://cdn-icons-png.flaticon.com/512/714/714032.png" width="70">
       <p style="font-size: 10px; text-align: center; color: gold;">B·∫§M NH·∫¨N QU√Ä</p>
   </div>
 
   <div id="man-hinh-chao" style="position:fixed; inset:0; z-index:9999; background: #000; display:flex; align-items:center; justify-content:center; text-align:center;">
       <div class="animate__animatedanimate__jackInTheBox" style="padding:40px; border:4pxsolid var(--tet-vang); border-radius:40px; background: var(--mtt-gradient); width: 90%; max-width: 450px;">
           <h1 style="color:var(--tet-vang); font-family:Pattaya; font-size: 3rem; margin-bottom: 10px;">XU√ÇN B√çNH NG·ªå</h1>
           <p style="margin-bottom: 25px; letter-spacing: 2px;">THPT MAI THANH TH·∫æ - S√ìC TRƒÇNG</p>
           <input type="text" id="ten-nguoi-dung" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." style="padding:15px; border-radius:30px; width:100%; margin-bottom: 20px; border:none; outline:none; font-size: 1.1rem; text-align: center;">
           <button class="nut-bam" style="width:100%; font-size: 1.2rem;" onclick="batDau()">KHAI XU√ÇN NGAY üêé</button>
       </div>
   </div>
 
   <div class="main-grid">
       <aside class="side">
           <div class="khung-glass" style="text-align: center;">
               <div style="position: relative; display: inline-block;">
                   <img id="my-avatar" src="" style="width:100px; border-radius:50%; border:4px solid var(--tet-vang); padding: 5px;">
                   <div id="user-rank" style="position: absolute; bottom: 0; right: 0; background: gold; color: #000; font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: 900;">T√ÇN BINH</div>
               </div>
               <h3 id="display-name" style="margin-top:15px; color:var(--tet-vang); font-size: 1.5rem;">---</h3>
               <hr style="margin: 15px 0; opacity: 0.2;">
               <p id="stats" style="font-size: 0.8rem; opacity: 0.8;">ƒêang t·∫£i d·ªØ li·ªáu...</p>
           </div>
       </aside>
 
       <main>
           <div class="khung-glass animate__animatedanimate__fadeInDown" style="margin-bottom:30px;">
               <textarea id="noi-dung-dang" placeholder="NƒÉm m·ªõi n√≥i l·ªùi y√™u th∆∞∆°ng c√πng MTT..." style="width:100%; height:100px; background:rgba(255,255,255,0.1); border:none; padding:20px; color:white; border-radius:20px; resize:none; outline:none; font-size: 1.1rem;"></textarea>
               <img id="preview-img" src="">
               <div style="display:flex; justify-content:space-between; margin-top:15px; align-items:center;">
                   <label style="color:var(--tet-vang); cursor:pointer; font-weight: 600;">
                       <i class="fas fa-camera-retro"></i> ƒê√≠nh k√®m ·∫£nh T·∫øt
                       <input type="file" id="file-input" hiddenaccept="image/*">
                   </label>
                   <button class="nut-bam" onclick="dangBai()">ƒêƒÇNG B·∫¢I üöÄ</button>
               </div>
           </div>
 
           <div id="bang-tin"></div>
       </main>
 
       <aside class="side">
           <div class="khung-glass">
               <h3 style="color:var(--tet-vang); margin-bottom:20px; text-align:center;"><i class="fas fa-crown"></i> CHI·∫æN TH·∫¶N MTT</h3>
               <div id="bang-xep-hang"></div>
           </div>
       </aside>
   </div>
 
   <div id="btn-music" class="dia-nhac" onclick="controlMusic()">
       <i class="fas fa-record-vinyl fa-2x" style="color: #740001;"></i>
       <audio id="nhac-tet" loop>
           <source src="https://files.catbox.moe/679i6u.mp3" type="audio/mpeg">
       </audio>
   </div>
 
   <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
       import { getDatabase, ref, push, onValue, update, get, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
 
       const firebaseConfig = { databaseURL: "https://tet-mtt-default-rtdb.firebaseio.com" };
       const app = initializeApp(firebaseConfig);
       const db = getDatabase(app);
       const dbRef = ref(db, 'mtt_pro_2026');
 
       window.USER = null;
       let base64Image = "";
 
       // Hi·ªáu ·ª©ng ph√°o hoa khi click
       window.createFirework = (e) => {
           if(e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
               confetti({
                   particleCount: 15,
                   startVelocity: 20,
                   spread: 360,
                   origin: { x: e.clientX / window.innerWidth, y: e.clientY / window.innerHeight },
                   colors: ['#ff0000', '#ffd700', '#ffffff']
               });
           }
       };
 
       // Nh·∫≠n l√¨ x√¨ ng·∫´u nhi√™n
       window.getLucky = (e) => {
           e.stopPropagation();
           const quotes = [
               "Ch√∫c b·∫°n nƒÉm m·ªõi v·∫°n s·ª± nh∆∞ √Ω!",
               "MTT ch√∫c b·∫°n thi ƒë·ªó nguy·ªán v·ªçng 1!",
               "NƒÉm m·ªõi tho√°t ·∫ø, h·ªçc gi·ªèi, ƒë·∫πp trai/g√°i!",
               "L√¨ x√¨ tinh th·∫ßn: M·ªôt tr√†ng ph√°o tay!",
               "Ch√∫c gia ƒë√¨nh b·∫°n b√¨nh an, h·∫°nh ph√∫c!"
           ];
           const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
           alert("üßß Qu√† t·∫∑ng t·ª´ MTT: " + randomQuote);
           confetti({ particleCount: 200, spread: 160, origin: { y: 0.6 } });
       };
 
       // Danh hi·ªáu theo Like
       const getRank = (likes) => {
           if (likes >= 100) return "HUY·ªÄN THO·∫†I MTT";
           if (likes >= 50) return "CHI·∫æN TH·∫¶N CH√öC T·∫æT";
           if (likes >= 20) return "TRAI XINH G√ÅI ƒê·∫∏P";
           return "T√ÇN BINH 2026";
       };
 
       // X·ª≠ l√Ω file ·∫£nh
       document.getElementById('file-input').addEventListener('change', (e) => {
           const file = e.target.files[0];
           const reader = new FileReader();
           reader.onloadend = () => {
               base64Image = reader.result;
               document.getElementById('preview-img').src = base64Image;
               document.getElementById('preview-img').style.display = 'block';
           };
           if(file) reader.readAsDataURL(file);
       });
 
       window.batDau = () => {
           const ten = document.getElementById('ten-nguoi-dung').value.trim();
           if(!ten) return alert("H√∫! Nh·∫≠p c√°i t√™n ƒë·ªÉ MTT c√≤n bi·∫øt ai n√®!");
           
           window.USER = { 
               name: ten, 
               avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(ten)}&background=ffa502&color=740001&bold=true&size=128` 
           };
           
           document.getElementById('man-hinh-chao').classList.add('animate__fadeOutOut');
           setTimeout(() => document.getElementById('man-hinh-chao').style.display = 'none', 500);
           
           document.getElementById('my-avatar').src = window.USER.avatar;
           document.getElementById('display-name').innerText = ten;
           document.getElementById('user-info').innerHTML = `<i class="fas fa-user-circle"></i> ${ten}`;
           
           const audio = document.getElementById('nhac-tet');
           audio.play().catch(() => console.log("C·∫ßn click ƒë·ªÉ ph√°t nh·∫°c"));
           document.getElementById('btn-music').classList.add('xoay');
 
           taiDuLieu();
       };
 
       window.dangBai = () => {
           const txt = document.getElementById('noi-dung-dang').value.trim();
           if(!txt && !base64Image) return;
 
           push(dbRef, {
               name: window.USER.name,
               avatar: window.USER.avatar,
               content: txt,
               image: base64Image,
               likes: 0,
               createdAt: serverTimestamp()
           }).then(() => {
               document.getElementById('noi-dung-dang').value = "";
               document.getElementById('preview-img').style.display = 'none';
               base64Image = "";
               // Hi·ªáu ·ª©ng ph√°o n·ªï khi ƒëƒÉng
               confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff0000', '#ffd700'] });
           });
       };
 
       function taiDuLieu() {
           onValue(dbRef, (snap) => {
               const feed = document.getElementById('bang-tin');
               const rankList = document.getElementById('bang-xep-hang');
               feed.innerHTML = "";
               const data = snap.val();
               if(!data) return;
 
               const posts = Object.keys(data).map(id => ({id, ...data[id]}));
               posts.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
 
               // T√≠nh t·ªïng Like c·ªßa user hi·ªán t·∫°i ƒë·ªÉ l√™n c·∫•p
               let myTotalLikes = 0;
               posts.forEach(p => { if(p.name === window.USER.name) myTotalLikes += p.likes; });
               document.getElementById('user-rank').innerText = getRank(myTotalLikes);
               document.getElementById('stats').innerText = `B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c ${myTotalLikes} ‚ù§Ô∏è`;
 
               posts.forEach(p => {
                   const postDiv = document.createElement('div');
                   postDiv.className = 'the-bai-viet animate__animated animate__fadeInUp';
                   postDiv.innerHTML = `
                       <div style="display:flex; align-items:center; gap:12px; padding:15px; border-bottom: 1px solid #eee;">
                           <img src="${p.avatar}" style="width:45px; border-radius:50%; border:2px solid var(--tet-vang);">
                           <div>
                               <b style="color:var(--tet-do);">${p.name}</b> <span class="badge">${getRank(p.likes)}</span><br>
                               <small style="color:#999; font-size: 10px;">${p.createdAt ? new Date(p.createdAt).toLocaleString('vi-VN') : 'V·ª´a ƒëƒÉng'}</small>
                           </div>
                       </div>
                       <div style="padding:15px;">
                           <p style="font-size:1rem; line-height:1.6; margin-bottom:12px; white-space: pre-wrap;">${p.content}</p>
                           ${p.image ? `<img src="${p.image}" style="width:100%; border-radius:15px; box-shadow: 0 5px15px rgba(0,0,0,0.1);">` : ''}
                           <div style="margin-top:15px; display:flex; justify-content: space-between; align-items: center;">
                               <button onclick="likeBai('${p.id}')" style="background:#fff2f2; border:none; padding:8px 18px; border-radius:20px; cursor:pointer; color:var(--tet-do); font-weight:800; display:flex; align-items:center; gap:5px;">
                                   <i class="fas fa-heart"></i> ${p.likes || 0}
                               </button>
                               <div style="color: #ccc; font-size: 12px;"><i class="fas fa-check-circle"></i> ƒê√£ x√°c th·ª±c MTT</div>
                           </div>
                       </div>
                   `;
                   feed.appendChild(postDiv);
               });
 
               // BXH Top 5
               rankList.innerHTML = "";
               const sortedRanks = [...posts].sort((a,b) => b.likes - a.likes).slice(0, 5);
               sortedRanks.forEach((p, i) => {
                   rankList.innerHTML += `
                       <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                           <span><b>#${i+1}</b> ${p.name}</span>
                           <b style="color:gold;">${p.likes} ‚ù§Ô∏è</b>
                       </div>`;
               });
           });
       }
 
       window.likeBai = (id) => {
           const r = ref(db, `mtt_pro_2026/${id}/likes`);
           get(r).then(s => {
               update(ref(db, `mtt_pro_2026/${id}`), { likes: (s.val() || 0) + 1 });
           });
           // Hi·ªáu ·ª©ng tim nh·ªè bay ra
           confetti({ particleCount: 20, spread: 50, origin: { x: 0.5, y: 0.8 }, colors: ['#ff4757'] });
       };
 
       window.controlMusic = () => {
           const a = document.getElementById('nhac-tet');
           const b = document.getElementById('btn-music');
           if(a.paused) { a.play(); b.classList.add('xoay'); }
           else { a.pause(); b.classList.remove('xoay'); }
       };
 
       // ƒê√®n l·ªìng bay
       setInterval(() => {
           const lanterns = ['üèÆ', 'üßß', 'üå∏', '‚ú®'];
           const l = document.createElement('div');
           l.className = 'lantern';
           l.style.left = Math.random() * 100 + "vw";
           l.innerText = lanterns[Math.floor(Math.random() * lanterns.length)];
           document.body.appendChild(l);
           l.animate([{top: '-50px'}, {top: '110vh'}], {duration: 8000 + Math.random() * 4000}).onfinish = () => l.remove();
       }, 1000);
 
   </script>
</body>
</html>

